{"version":3,"file":"storage.js","sources":["../src/shared/storage.ts"],"sourcesContent":["import type { TranslationSettings } from './types';\r\n\r\n// 默认设置\r\nexport const DEFAULT_SETTINGS: TranslationSettings = {\r\n  enabled: true,\r\n  mode: 'brief',\r\n  showNotes: true,\r\n  position: 'right'\r\n};\r\n\r\n// 存储键名\r\nexport const STORAGE_KEYS = {\r\n  SETTINGS: 'ds160_translation_settings',\r\n  INJECTION_STATE: 'ds160_injection_state'\r\n} as const;\r\n\r\n// 获取设置\r\nexport async function getSettings(): Promise<TranslationSettings> {\r\n  try {\r\n    const result = await chrome.storage.local.get(STORAGE_KEYS.SETTINGS);\r\n    return { ...DEFAULT_SETTINGS, ...result[STORAGE_KEYS.SETTINGS] };\r\n  } catch (error) {\r\n    console.error('Error loading settings:', error);\r\n    return DEFAULT_SETTINGS;\r\n  }\r\n}\r\n\r\n// 保存设置\r\nexport async function saveSettings(settings: Partial<TranslationSettings>): Promise<void> {\r\n  try {\r\n    const currentSettings = await getSettings();\r\n    const newSettings = { ...currentSettings, ...settings };\r\n    await chrome.storage.local.set({ [STORAGE_KEYS.SETTINGS]: newSettings });\r\n  } catch (error) {\r\n    console.error('Error saving settings:', error);\r\n  }\r\n}\r\n\r\n// 监听设置变化\r\nexport function onSettingsChange(callback: (settings: TranslationSettings) => void): void {\r\n  chrome.storage.onChanged.addListener((changes, namespace) => {\r\n    if (namespace === 'local' && changes[STORAGE_KEYS.SETTINGS]) {\r\n      callback(changes[STORAGE_KEYS.SETTINGS].newValue);\r\n    }\r\n  });\r\n}\r\n"],"names":[],"mappings":"AAGO,MAAM,mBAAwC;AAAA,EACnD,SAAS;AAAA,EACT,MAAM;AAAA,EACN,WAAW;AAAA,EACX,UAAU;AACZ;AAGO,MAAM,eAAe;AAAA,EAC1B,UAAU;AAAA,EACV,iBAAiB;AACnB;AAGA,eAAsB,cAA4C;AAChE,MAAI;AACF,UAAM,SAAS,MAAM,OAAO,QAAQ,MAAM,IAAI,aAAa,QAAQ;AACnE,WAAO,EAAE,GAAG,kBAAkB,GAAG,OAAO,aAAa,QAAQ,EAAA;AAAA,EAC/D,SAAS,OAAO;AACd,YAAQ,MAAM,2BAA2B,KAAK;AAC9C,WAAO;AAAA,EACT;AACF;AAGA,eAAsB,aAAa,UAAuD;AACxF,MAAI;AACF,UAAM,kBAAkB,MAAM,YAAA;AAC9B,UAAM,cAAc,EAAE,GAAG,iBAAiB,GAAG,SAAA;AAC7C,UAAM,OAAO,QAAQ,MAAM,IAAI,EAAE,CAAC,aAAa,QAAQ,GAAG,aAAa;AAAA,EACzE,SAAS,OAAO;AACd,YAAQ,MAAM,0BAA0B,KAAK;AAAA,EAC/C;AACF;AAGO,SAAS,iBAAiB,UAAyD;AACxF,SAAO,QAAQ,UAAU,YAAY,CAAC,SAAS,cAAc;AAC3D,QAAI,cAAc,WAAW,QAAQ,aAAa,QAAQ,GAAG;AAC3D,eAAS,QAAQ,aAAa,QAAQ,EAAE,QAAQ;AAAA,IAClD;AAAA,EACF,CAAC;AACH;"}