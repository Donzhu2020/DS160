{"version":3,"file":"service-worker.js","sources":["../../src/background/debug-service-worker.ts"],"sourcesContent":["// 调试版本的后台脚本 - 支持手动注入\r\n\r\nconsole.log('DS-160 Debug Background: Starting...');\r\n\r\n// 监听扩展安装\r\nchrome.runtime.onInstalled.addListener(() => {\r\n  console.log('DS-160 Debug Background: Extension installed');\r\n});\r\n\r\n// 监听标签页更新，主动注入脚本\r\nchrome.tabs.onUpdated.addListener(async (tabId, changeInfo, tab) => {\r\n  if (changeInfo.status === 'complete' && tab.url) {\r\n    console.log('DS-160 Debug Background: Tab updated:', tab.url);\r\n    \r\n    try {\r\n      // 手动注入调试脚本\r\n      await chrome.scripting.executeScript({\r\n        target: { tabId: tabId },\r\n        func: () => {\r\n          // 内联调试脚本\r\n          console.log('DS-160 Manual Injection: Starting...');\r\n          console.log('DS-160 Manual Injection: URL:', window.location.href);\r\n          console.log('DS-160 Manual Injection: Title:', document.title);\r\n          \r\n          // 添加消息监听器\r\n          if (!window.ds160DebugInjected) {\r\n            window.ds160DebugInjected = true;\r\n            \r\n            chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\r\n              console.log('DS-160 Manual Injection: Received message:', message);\r\n              \r\n              if (message.type === 'GET_TRANSLATION_STATUS') {\r\n                console.log('DS-160 Manual Injection: Responding to status request');\r\n                sendResponse({\r\n                  initialized: true,\r\n                  enabled: true,\r\n                  translatedCount: 99, // 区分手动注入\r\n                  pageType: 'manual-injection',\r\n                  debug: true,\r\n                  url: window.location.href,\r\n                  title: document.title\r\n                });\r\n              }\r\n              \r\n              return true;\r\n            });\r\n            \r\n            // 延迟检查页面内容\r\n            setTimeout(() => {\r\n              const labels = document.querySelectorAll('label');\r\n              const inputs = document.querySelectorAll('input');\r\n              const bodyText = document.body.textContent || '';\r\n              const hasDS160Content = bodyText.includes('Surname') || bodyText.includes('Given Names') || bodyText.includes('DS-160');\r\n              \r\n              console.log('DS-160 Manual Injection: Found labels:', labels.length);\r\n              console.log('DS-160 Manual Injection: Found inputs:', inputs.length);\r\n              console.log('DS-160 Manual Injection: Has DS-160 content:', hasDS160Content);\r\n              console.log('DS-160 Manual Injection: Body preview:', bodyText.substring(0, 200));\r\n            }, 1000);\r\n          }\r\n        }\r\n      });\r\n      \r\n      console.log('DS-160 Debug Background: Script injected successfully for tab:', tabId);\r\n    } catch (error) {\r\n      console.log('DS-160 Debug Background: Failed to inject script:', error);\r\n    }\r\n  }\r\n});\r\n\r\n// 处理来自popup的消息\r\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\r\n  console.log('DS-160 Debug Background: Received message:', message);\r\n  sendResponse({ success: true });\r\n  return true;\r\n});\r\n\r\nexport {};\r\n"],"names":[],"mappings":"AAEA,QAAQ,IAAI,sCAAsC;AAGlD,OAAO,QAAQ,YAAY,YAAY,MAAM;AAC3C,UAAQ,IAAI,8CAA8C;AAC5D,CAAC;AAGD,OAAO,KAAK,UAAU,YAAY,OAAO,OAAO,YAAY,QAAQ;AAClE,MAAI,WAAW,WAAW,cAAc,IAAI,KAAK;AAC/C,YAAQ,IAAI,yCAAyC,IAAI,GAAG;AAE5D,QAAI;AAEF,YAAM,OAAO,UAAU,cAAc;AAAA,QACnC,QAAQ,EAAE,MAAA;AAAA,QACV,MAAM,MAAM;AAEV,kBAAQ,IAAI,sCAAsC;AAClD,kBAAQ,IAAI,iCAAiC,OAAO,SAAS,IAAI;AACjE,kBAAQ,IAAI,mCAAmC,SAAS,KAAK;AAG7D,cAAI,CAAC,OAAO,oBAAoB;AAC9B,mBAAO,qBAAqB;AAE5B,mBAAO,QAAQ,UAAU,YAAY,CAAC,SAAS,QAAQ,iBAAiB;AACtE,sBAAQ,IAAI,8CAA8C,OAAO;AAEjE,kBAAI,QAAQ,SAAS,0BAA0B;AAC7C,wBAAQ,IAAI,uDAAuD;AACnE,6BAAa;AAAA,kBACX,aAAa;AAAA,kBACb,SAAS;AAAA,kBACT,iBAAiB;AAAA;AAAA,kBACjB,UAAU;AAAA,kBACV,OAAO;AAAA,kBACP,KAAK,OAAO,SAAS;AAAA,kBACrB,OAAO,SAAS;AAAA,gBAAA,CACjB;AAAA,cACH;AAEA,qBAAO;AAAA,YACT,CAAC;AAGD,uBAAW,MAAM;AACf,oBAAM,SAAS,SAAS,iBAAiB,OAAO;AAChD,oBAAM,SAAS,SAAS,iBAAiB,OAAO;AAChD,oBAAM,WAAW,SAAS,KAAK,eAAe;AAC9C,oBAAM,kBAAkB,SAAS,SAAS,SAAS,KAAK,SAAS,SAAS,aAAa,KAAK,SAAS,SAAS,QAAQ;AAEtH,sBAAQ,IAAI,0CAA0C,OAAO,MAAM;AACnE,sBAAQ,IAAI,0CAA0C,OAAO,MAAM;AACnE,sBAAQ,IAAI,gDAAgD,eAAe;AAC3E,sBAAQ,IAAI,0CAA0C,SAAS,UAAU,GAAG,GAAG,CAAC;AAAA,YAClF,GAAG,GAAI;AAAA,UACT;AAAA,QACF;AAAA,MAAA,CACD;AAED,cAAQ,IAAI,kEAAkE,KAAK;AAAA,IACrF,SAAS,OAAO;AACd,cAAQ,IAAI,qDAAqD,KAAK;AAAA,IACxE;AAAA,EACF;AACF,CAAC;AAGD,OAAO,QAAQ,UAAU,YAAY,CAAC,SAAS,QAAQ,iBAAiB;AACtE,UAAQ,IAAI,8CAA8C,OAAO;AACjE,eAAa,EAAE,SAAS,MAAM;AAC9B,SAAO;AACT,CAAC;"}